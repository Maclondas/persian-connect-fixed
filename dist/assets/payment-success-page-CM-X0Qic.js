const __vite__mapDeps=(i,m=__vite__mapDeps,d=(m.f||(m.f=["assets/index-DeJ9lC2K.js","assets/index-D5Irw3zp.css"])))=>i.map(i=>d[i]);
import{r as n,_ as p,t as m,j as e,s as y,v as f,w as P,x as S,y as _,n as C,C as A,z as g,H as k}from"./index-DeJ9lC2K.js";import{R as E}from"./receipt-BtrxGc0v.js";function Y({onNavigate:r}){const[x,u]=n.useState(null),[j,h]=n.useState(!0),i=n.useCallback(async o=>{try{console.log("ðŸ” Verifying payment for session:",o);const s=localStorage.getItem("pendingAdId"),t=localStorage.getItem("pendingPaymentId");if(!s||!t)throw new Error("Payment context not found");const{projectId:w}=await p(async()=>{const{projectId:a}=await import("./index-DeJ9lC2K.js").then(d=>d.aq);return{projectId:a}},__vite__mapDeps([0,1])),{getSupabaseClient:b}=await p(async()=>{const{getSupabaseClient:a}=await import("./index-DeJ9lC2K.js").then(d=>d.ap);return{getSupabaseClient:a}},__vite__mapDeps([0,1])),v=b(),{data:{session:l},error:N}=await v.auth.getSession();if(N||!l||!l.access_token)throw new Error("Authentication required");const I=`https://${w}.supabase.co/functions/v1/make-server-e5dee741`,c=await fetch(`${I}/payments/verify-session`,{method:"POST",headers:{"Content-Type":"application/json",Authorization:`Bearer ${l.access_token}`},body:JSON.stringify({sessionId:o,paymentId:t,adId:s})});if(!c.ok){const a=await c.text();throw new Error(`Payment verification failed: ${a}`)}if((await c.json()).verified)m.success("Payment confirmed! Your ad is being processed..."),h(!1),localStorage.removeItem("pendingAdId"),localStorage.removeItem("pendingPaymentId"),localStorage.removeItem("pendingPaymentSessionId");else throw new Error("Payment verification failed")}catch(s){console.error("âŒ Payment verification error:",s),m.error("Payment verification failed"),h(!1)}},[]);return n.useEffect(()=>{const s=new URLSearchParams(window.location.search).get("session_id");if(s)u(s),i(s);else{const t=localStorage.getItem("pendingPaymentSessionId");t?(u(t),i(t)):(m.error("Payment session not found"),setTimeout(()=>r("home"),3e3))}},[r,i]),j?e.jsx("div",{className:"min-h-screen bg-gray-50 flex items-center justify-center",children:e.jsx(y,{className:"w-full max-w-md",children:e.jsxs(f,{className:"p-8 text-center",children:[e.jsx("div",{className:"animate-spin rounded-full h-12 w-12 border-b-2 border-primary mx-auto mb-4"}),e.jsx("h2",{className:"text-xl font-semibold mb-2",children:"Processing Payment"}),e.jsx("p",{className:"text-gray-600",children:"Please wait while we verify your payment..."})]})})}):e.jsx("div",{className:"min-h-screen bg-gray-50 flex items-center justify-center",children:e.jsxs(y,{className:"w-full max-w-md",children:[e.jsxs(P,{className:"text-center",children:[e.jsx("div",{className:"mx-auto w-16 h-16 bg-green-100 rounded-full flex items-center justify-center mb-4",children:e.jsx(S,{className:"h-8 w-8 text-green-600"})}),e.jsx(_,{className:"text-2xl text-green-600",children:"Payment Successful!"})]}),e.jsxs(f,{className:"text-center space-y-4",children:[e.jsxs("p",{className:"text-gray-600",children:["Your payment of ",e.jsx("strong",{children:"$2.00 USD"})," has been processed successfully."]}),e.jsxs("div",{className:"bg-blue-50 border border-blue-200 rounded-lg p-4",children:[e.jsxs("div",{className:"flex items-center justify-center mb-2",children:[e.jsx(C,{className:"h-5 w-5 text-blue-600 mr-2"}),e.jsx("span",{className:"font-medium text-blue-800",children:"Ad Under Review"})]}),e.jsx("p",{className:"text-sm text-blue-700",children:"Your ad is being reviewed by our AI moderation system for quality and safety. This usually takes just a few minutes."})]}),e.jsxs("div",{className:"bg-yellow-50 border border-yellow-200 rounded-lg p-4",children:[e.jsxs("div",{className:"flex items-center justify-center mb-2",children:[e.jsx(A,{className:"h-5 w-5 text-yellow-600 mr-2"}),e.jsx("span",{className:"font-medium text-yellow-800",children:"What happens next?"})]}),e.jsxs("div",{className:"text-sm text-yellow-700 space-y-1",children:[e.jsx("p",{children:"â€¢ AI review: Usually completed within 5 minutes"}),e.jsx("p",{children:"â€¢ If approved: Your ad goes live immediately"}),e.jsx("p",{children:"â€¢ If flagged: Admin review (up to 24 hours)"}),e.jsx("p",{children:"â€¢ Ad duration: 30 days from approval"})]})]}),x&&e.jsxs("div",{className:"bg-gray-100 p-3 rounded-lg",children:[e.jsx("p",{className:"text-sm text-gray-500 mb-1",children:"Transaction ID:"}),e.jsx("p",{className:"text-xs font-mono text-gray-700 break-all",children:x})]}),e.jsxs("div",{className:"flex flex-col sm:flex-row gap-3 pt-4",children:[e.jsxs(g,{onClick:()=>r("my-ads"),variant:"outline",className:"flex-1",children:[e.jsx(E,{className:"h-4 w-4 mr-2"}),"View My Ads"]}),e.jsxs(g,{onClick:()=>r("home"),className:"flex-1 bg-primary hover:bg-primary/90",children:[e.jsx(k,{className:"h-4 w-4 mr-2"}),"Back to Home"]})]}),e.jsx("p",{className:"text-xs text-gray-500 pt-4",children:"You will receive an email confirmation shortly."})]})]})})}export{Y as PaymentSuccessPage};
