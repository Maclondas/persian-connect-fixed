const __vite__mapDeps=(i,m=__vite__mapDeps,d=(m.f||(m.f=["assets/index-CopSRaJ1.js","assets/index-oMMyjAwi.css"])))=>i.map(i=>d[i]);
import{r as l,j as e,s as p,v as u,L as C,w as I,E as v,y as P,z as x,A as _,J as S,_ as h}from"./index-CopSRaJ1.js";function k({onNavigate:c}){const[y,o]=l.useState(!1),[i,g]=l.useState(!1);return l.useEffect(()=>{(async()=>{try{o(!0);const a=localStorage.getItem("pendingAdId"),t=localStorage.getItem("pendingPaymentId"),d=localStorage.getItem("paymentSessionId")||new URLSearchParams(window.location.search).get("session_id");if(a&&t){console.log("🧹 Cleaning up failed payment:",{pendingAdId:a,pendingPaymentId:t,sessionId:d});const{projectId:f}=await h(async()=>{const{projectId:s}=await import("./index-CopSRaJ1.js").then(r=>r.aq);return{projectId:s}},__vite__mapDeps([0,1])),{getSupabaseClient:j}=await h(async()=>{const{getSupabaseClient:s}=await import("./index-CopSRaJ1.js").then(r=>r.ap);return{getSupabaseClient:s}},__vite__mapDeps([0,1])),w=j(),{data:{session:n},error:N}=await w.auth.getSession();if(N||!n||!n.access_token){console.error("❌ Authentication error during cleanup");return}const b=`https://${f}.supabase.co/functions/v1/make-server-e5dee741`,m=await fetch(`${b}/payments/handle-failure`,{method:"POST",headers:{"Content-Type":"application/json",Authorization:`Bearer ${n.access_token}`},body:JSON.stringify({sessionId:d,paymentId:t,adId:a,reason:"payment_cancelled"})});if(m.ok){const s=await m.json();console.log("✅ Payment failure cleanup successful:",s),g(!0),localStorage.removeItem("pendingAdId"),localStorage.removeItem("pendingPaymentId"),localStorage.removeItem("paymentSessionId")}else console.error("❌ Payment failure cleanup failed")}}catch(a){console.error("❌ Error during payment failure cleanup:",a)}finally{o(!1)}})()},[]),y?e.jsx("div",{className:"min-h-screen bg-gray-50 flex items-center justify-center",children:e.jsx(p,{className:"w-full max-w-md",children:e.jsxs(u,{className:"p-8 text-center",children:[e.jsx(C,{className:"h-12 w-12 animate-spin text-primary mx-auto mb-4"}),e.jsx("h2",{className:"text-xl font-semibold mb-2",children:"Processing..."}),e.jsx("p",{className:"text-gray-600",children:"Cleaning up after payment cancellation..."})]})})}):e.jsx("div",{className:"min-h-screen bg-gray-50 flex items-center justify-center",children:e.jsxs(p,{className:"w-full max-w-md",children:[e.jsxs(I,{className:"text-center",children:[e.jsx("div",{className:"mx-auto w-16 h-16 bg-red-100 rounded-full flex items-center justify-center mb-4",children:e.jsx(v,{className:"h-8 w-8 text-red-600"})}),e.jsx(P,{className:"text-2xl text-red-600",children:"Payment Failed"})]}),e.jsxs(u,{className:"text-center space-y-4",children:[e.jsx("p",{className:"text-gray-600",children:"Your payment could not be processed. This could be due to:"}),e.jsxs("ul",{className:"text-left space-y-2 text-sm text-gray-600",children:[e.jsx("li",{children:"• Insufficient funds"}),e.jsx("li",{children:"• Card was declined"}),e.jsx("li",{children:"• Payment was cancelled"}),e.jsx("li",{children:"• Network connectivity issues"})]}),e.jsx("div",{className:"bg-blue-50 border border-blue-200 rounded-lg p-3 mt-4",children:e.jsxs("p",{className:"text-sm text-blue-800",children:[e.jsx("strong",{children:i?"No charges applied.":"Don't worry!"})," ",i?"Your payment was cancelled and no ad was posted.":"Your ad information has been saved and you can try again."]})}),e.jsxs("div",{className:"flex flex-col sm:flex-row gap-3 pt-4",children:[e.jsxs(x,{onClick:()=>c("post-ad"),variant:"outline",className:"flex-1",children:[e.jsx(_,{className:"h-4 w-4 mr-2"}),"Back to Ad"]}),e.jsxs(x,{onClick:()=>c("post-ad"),className:"flex-1 bg-primary hover:bg-primary/90",children:[e.jsx(S,{className:"h-4 w-4 mr-2"}),"Try Again"]})]}),e.jsx("p",{className:"text-xs text-gray-500 pt-4",children:"Need help? Contact our support team."})]})]})})}export{k as PaymentFailedPage};
